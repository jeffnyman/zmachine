<PACKAGE "ZOPS">

<ENTRY OP DEFOPS OPCODE PRED? VAL? SPEC SPEC? OPFUNCT OPATOM>

<NEWTYPE OP VECTOR '<OP FIX [2 <OR ATOM FALSE>] STRING APPLICABLE ATOM>>
<SETG OPCODE <OFFSET 1 OP>>
<SETG PRED? <OFFSET 2 OP>>
<SETG VAL? <OFFSET 3 OP>>
<SETG SPEC <OFFSET 4 OP>>
<SETG OPFUNCT <OFFSET 5 OP>>
<SETG OPATOM <OFFSET 6 OP>>
<MANIFEST OPCODE PRED? VAL? SPEC OPFUNCT OPATOM>
<DEFMAC SPEC? ('ZOP 'STR) <FORM =? <FORM SPEC .ZOP> .STR>>

<DEFINE OP-PRINT (ZOP)
	#DECL ((ZOP) OP)
	<PRINC "#OP ">
	<PRIN1 <OPATOM .ZOP>>>

<PRINTTYPE OP ,OP-PRINT>

<DEFINE OPERR ("TUPLE" TUP)
	<ERROR ATTEMPT-TO-USE-UNDEFINED-OP!-ERRORS !.TUP>>

<DEFINE DEFOP (OPR OPCODE PRED? VAL? "OPTIONAL" (SPEC "")
	       "AUX" (ZOPOB .ZOPOB) OPATM (OPTABLE .OPTABLE) ZOP)
	#DECL ((VALUE ZOP) OP
	       (OPR SPEC) STRING
	       (OPCODE) FIX
	       (PRED? VAL?) <OR ATOM FALSE>
	       (ZOPOB) OBLIST
	       (OPATM) ATOM
	       (OPTABLE) <OR <VECTOR <OR OP FALSE>> FALSE>)
	<SET OPATM <OR <LOOKUP .OPR .ZOPOB> <INSERT .OPR .ZOPOB>>>
	<EVAL <FORM GDECL (.OPATM) OP>>
	<SET ZOP <CHTYPE [.OPCODE .PRED? .VAL? .SPEC ,OPERR .OPATM] OP>>
	<AND .OPTABLE
	     <PUT .OPTABLE <+ .OPCODE 1> .ZOP>
	     <COND (<L? .OPCODE 128>
		    <PUT .OPTABLE <+ .OPCODE 33> .ZOP>
		    <PUT .OPTABLE <+ .OPCODE 65> .ZOP>
		    <PUT .OPTABLE <+ .OPCODE 97> .ZOP>
		    <PUT .OPTABLE <+ .OPCODE 193> .ZOP>)
		   (<L? .OPCODE 176>
		    <PUT .OPTABLE <+ .OPCODE 17> .ZOP>
		    <PUT .OPTABLE <+ .OPCODE 33> .ZOP>)>>
	<SETG .OPATM .ZOP>>

<DEFINE DEFOPS (ZOPOB "OPTIONAL" (OPTABLE <>))
	#DECL ((ZOPOB) <SPECIAL OBLIST>
	       (OPTABLE) <SPECIAL <OR <VECTOR <OR OP FALSE>> FALSE>>)
	<DEFOP "EQUAL?"	1	T	<>	"XARGS">
	<DEFOP "LESS?"	2	T	<>>
	<DEFOP "GRTR?"	3	T	<>>
	<DEFOP "DLESS?"	4	T	<>>
	<DEFOP "IGRTR?"	5	T	<>>
	<DEFOP "IN?"	6	T	<>>
	<DEFOP "BTST"	7	T	<>>
	<DEFOP "BOR"	8	<>	T>
	<DEFOP "BAND"	9	<>	T>
	<DEFOP "FSET?"	10	T	<>>
	<DEFOP "FSET"	11	<>	<>>
	<DEFOP "FCLEAR"	12	<>	<>>
	<DEFOP "SET"	13	<>	<>>
	<DEFOP "MOVE"	14	<>	<>>
	<DEFOP "GET"	15	<>	T>
	<DEFOP "GETB"	16	<>	T>
	<DEFOP "GETP"	17	<>	T>
	<DEFOP "GETPT"	18	<>	T>
	<DEFOP "NEXTP"	19	<>	T>
	<DEFOP "ADD"	20	<>	T>
	<DEFOP "SUB"	21	<>	T>
	<DEFOP "MUL"	22	<>	T>
	<DEFOP "DIV"	23	<>	T>
	<DEFOP "MOD"	24	<>	T>
	<DEFOP "PRINTT"	25	<>	<>>	;"Obsolete"
	<DEFOP "ZERO?"	128	T	<>>
	<DEFOP "NEXT?"	129	T	T>
	<DEFOP "FIRST?"	130	T	T>
	<DEFOP "LOC"	131	<>	T>
	<DEFOP "PTSIZE"	132	<>	T>
	<DEFOP "INC"	133	<>	<>>
	<DEFOP "DEC"	134	<>	<>>
	<DEFOP "PRINTB"	135	<>	<>>
	<DEFOP "REMOVE"	137	<>	<>>
	<DEFOP "PRINTD"	138	<>	<>>
	<DEFOP "RETURN"	139	<>	<>>
	<DEFOP "JUMP"	140	<>	<>	"BRANCH">
	<DEFOP "PRINT"	141	<>	<>>
	<DEFOP "VALUE"	142	<>	T>
	<DEFOP "BCOM"	143	<>	T>
	<DEFOP "RTRUE"	176	<>	<>>
	<DEFOP "RFALSE"	177	<>	<>>
	<DEFOP "PRINTI"	178	<>	<>	"STRING">
	<DEFOP "PRINTR"	179	<>	<>	"STRING">
	<DEFOP "NOOP"	180	<>	<>>
	<DEFOP "SAVE"	181	T	<>>
	<DEFOP "RESTORE"182	T	<>>
	<DEFOP "RESTART"183	<>	<>>
	<DEFOP "RSTACK"	184	<>	<>>
	<DEFOP "FSTACK"	185	<>	<>>
	<DEFOP "QUIT"	186	<>	<>>
	<DEFOP "CRLF"	187	<>	<>>
	<DEFOP "CALL"	224	<>	T>
	<DEFOP "PUT"	225	<>	<>>
	<DEFOP "PUTB"	226	<>	<>>
	<DEFOP "PUTP"	227	<>	<>>
	<DEFOP "READ"	228	<>	<>>
	<DEFOP "PRINTC"	229	<>	<>>
	<DEFOP "PRINTN"	230	<>	<>>
	<DEFOP "RANDOM"	231	<>	T>
	<DEFOP "PUSH"	232	<>	<>>
	<DEFOP "POP"	233	<>	<>>>

<ENDPACKAGE>
